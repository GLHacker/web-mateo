<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subir Fotos a Firebase</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 900px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .subtitle {
            color: #64748b;
            margin-bottom: 30px;
        }

        .upload-zone {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            background: #f8f9ff;
            transition: all 0.3s;
            cursor: pointer;
        }

        .upload-zone:hover {
            background: #f0f2ff;
            border-color: #764ba2;
        }

        .upload-zone.dragging {
            background: #e0e4ff;
            border-color: #764ba2;
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        input[type="file"] {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .progress-container {
            margin-top: 30px;
            display: none;
        }

        .progress-bar {
            background: #e0e7ff;
            border-radius: 10px;
            height: 30px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .photos-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .photo-preview {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .photo-preview img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .photo-status {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px;
            font-size: 0.8rem;
            text-align: center;
        }

        .status-pending {
            background: rgba(255, 165, 0, 0.8);
        }

        .status-uploading {
            background: rgba(59, 130, 246, 0.8);
        }

        .status-success {
            background: rgba(34, 197, 94, 0.8);
        }

        .status-error {
            background: rgba(239, 68, 68, 0.8);
        }

        .log {
            background: #1e293b;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
            display: none;
        }

        .log-entry {
            margin-bottom: 5px;
        }

        .log-success {
            color: #22c55e;
        }

        .log-error {
            color: #ef4444;
        }

        .log-info {
            color: #3b82f6;
        }

        .log-warning {
            color: #f59e0b;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üì∏ Subir Fotos a Firebase</h1>
        <p class="subtitle">Sube todas las fotos de Mateo a la galer√≠a</p>

        <div class="upload-zone" id="uploadZone">
            <div class="upload-icon">üìÅ</div>
            <h2>Arrastra las fotos aqu√≠</h2>
            <p>o haz clic para seleccionarlas</p>
            <input type="file" id="fileInput" multiple accept="image/*">
        </div>

        <div style="text-align: center;">
            <button class="btn" id="uploadBtn" disabled>
                üöÄ Subir Todas las Fotos
            </button>
            <button class="btn" id="clearBtn" style="background: #ef4444;">
                üóëÔ∏è Limpiar
            </button>
        </div>

        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            <p id="progressText" style="text-align: center; color: #64748b;">
                0 de 0 fotos subidas
            </p>
        </div>

        <div class="photos-preview" id="photosPreview"></div>

        <div class="log" id="log"></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDesr25T22dRcgQ_mckKnj-OlRs5rXZShw",
            authDomain: "web-mateo.firebaseapp.com",
            projectId: "web-mateo",
            storageBucket: "web-mateo.firebasestorage.app",
            messagingSenderId: "1022636533086",
            appId: "1:1022636533086:web:5fa482ea817a3d74409bcf",
            measurementId: "G-G6RCZJC2DJ"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();
        const db = firebase.firestore();

        // Metadata para cada foto (puedes personalizarlo)
        const photoMetadata = {
            'closeup.jpg': { caption: 'Mateo de cerca', category: 'family' },
            'elmo.jpg': { caption: 'Mateo con Elmo', category: 'toys' },
            'family_studio.jpg': { caption: 'Familia en el estudio', category: 'family' },
            'grandpa.jpg': { caption: 'Mateo con el abuelo', category: 'family' },
            'img1.jpg': { caption: 'Momento especial', category: 'family' },
            'img2.jpg': { caption: 'Momento especial', category: 'family' },
            'img3.jpg': { caption: 'Momento especial', category: 'family' },
            'img4.jpg': { caption: 'Momento especial', category: 'family' },
            'img5.jpg': { caption: 'Momento especial', category: 'family' },
            'laughing_bed.jpg': { caption: 'Riendo en la cama', category: 'happy' },
            'mateo_bed.jpg': { caption: 'Mateo en la cama', category: 'daily' },
            'mateo_star.jpg': { caption: 'Mateo estrella', category: 'special' },
            'red_car_1.jpg': { caption: 'Mateo con su coche rojo', category: 'toys' },
            'red_car_2.jpg': { caption: 'Mateo en el coche rojo', category: 'toys' },
            'standing.jpg': { caption: 'Mateo de pie', category: 'milestones' },
            'three_generations.jpg': { caption: 'Tres generaciones', category: 'family' },
            'videocall_dad.jpg': { caption: 'Videollamada con pap√°', category: 'family' },
            'videocall_party.jpg': { caption: 'Fiesta en videollamada', category: 'celebration' },
            'videocall_smile.jpg': { caption: 'Sonrisa en videollamada', category: 'happy' },
            'videocall_yellow.jpg': { caption: 'Videollamada', category: 'family' }
        };

        // State
        let selectedFiles = [];
        let uploadResults = [];

        // Elements
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const clearBtn = document.getElementById('clearBtn');
        const photosPreview = document.getElementById('photosPreview');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const logDiv = document.getElementById('log');

        // Event Listeners
        uploadZone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelect);
        uploadBtn.addEventListener('click', uploadAllPhotos);
        clearBtn.addEventListener('click', clearAll);

        // Drag & Drop
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragging');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragging');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragging');
            const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/'));
            handleFiles(files);
        });

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            handleFiles(files);
        }

        function handleFiles(files) {
            selectedFiles = files;
            uploadBtn.disabled = files.length === 0;
            displayPhotosPreview();
            log(`‚úÖ ${files.length} fotos seleccionadas`, 'success');
        }

        function displayPhotosPreview() {
            photosPreview.innerHTML = '';
            selectedFiles.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const div = document.createElement('div');
                    div.className = 'photo-preview';
                    div.id = `photo-${index}`;
                    div.innerHTML = `
                        <img src="${e.target.result}" alt="${file.name}">
                        <div class="photo-status status-pending" id="status-${index}">‚è≥ Pendiente</div>
                    `;
                    photosPreview.appendChild(div);
                };
                reader.readAsDataURL(file);
            });
        }

        async function uploadAllPhotos() {
            if (selectedFiles.length === 0) {
                alert('Por favor selecciona fotos primero');
                return;
            }

            uploadBtn.disabled = true;
            clearBtn.disabled = true;
            progressContainer.style.display = 'block';
            logDiv.style.display = 'block';
            uploadResults = [];

            log(`üöÄ Iniciando subida de ${selectedFiles.length} fotos...`, 'info');

            for (let i = 0; i < selectedFiles.length; i++) {
                const file = selectedFiles[i];
                await uploadSinglePhoto(file, i);

                // Update progress
                const percentage = Math.round(((i + 1) / selectedFiles.length) * 100);
                progressFill.style.width = percentage + '%';
                progressFill.textContent = percentage + '%';
                progressText.textContent = `${i + 1} de ${selectedFiles.length} fotos subidas`;
            }

            const successCount = uploadResults.filter(r => r.success).length;
            const errorCount = uploadResults.filter(r => !r.success).length;

            log(`\n‚ú® ¬°Proceso completado!`, 'success');
            log(`   ‚úÖ Exitosas: ${successCount}`, 'success');
            if (errorCount > 0) {
                log(`   ‚ùå Errores: ${errorCount}`, 'error');
            }

            uploadBtn.disabled = false;
            clearBtn.disabled = false;
        }

        async function uploadSinglePhoto(file, index) {
            const statusEl = document.getElementById(`status-${index}`);
            statusEl.textContent = '‚è´ Subiendo...';
            statusEl.className = 'photo-status status-uploading';

            try {
                log(`üì§ Subiendo: ${file.name}`, 'info');

                // Upload to Storage
                const filename = `photos/${Date.now()}_${file.name}`;
                const storageRef = storage.ref(filename);
                const snapshot = await storageRef.put(file);
                const downloadURL = await snapshot.ref.getDownloadURL();

                log(`   ‚úì Storage: ${file.name}`, 'success');

                // Get metadata
                const metadata = photoMetadata[file.name] || {
                    caption: file.name.replace(/\.(jpg|jpeg|png|gif)$/i, ''),
                    category: 'family'
                };

                // Save to Firestore
                await db.collection('photos').add({
                    url: downloadURL,
                    caption: metadata.caption,
                    category: metadata.category,
                    likes: 0,
                    comments: [],
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });

                log(`   ‚úì Firestore: ${metadata.caption}`, 'success');

                statusEl.textContent = '‚úÖ Subida';
                statusEl.className = 'photo-status status-success';
                uploadResults.push({ file: file.name, success: true });

            } catch (error) {
                console.error('Error:', error);
                log(`   ‚ùå Error: ${file.name} - ${error.message}`, 'error');
                statusEl.textContent = '‚ùå Error';
                statusEl.className = 'photo-status status-error';
                uploadResults.push({ file: file.name, success: false, error: error.message });
            }
        }

        function clearAll() {
            selectedFiles = [];
            uploadResults = [];
            photosPreview.innerHTML = '';
            progressContainer.style.display = 'none';
            logDiv.style.display = 'none';
            logDiv.innerHTML = '';
            progressFill.style.width = '0%';
            progressFill.textContent = '0%';
            progressText.textContent = '0 de 0 fotos subidas';
            uploadBtn.disabled = true;
            fileInput.value = '';
        }

        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
    </script>
</body>

</html>